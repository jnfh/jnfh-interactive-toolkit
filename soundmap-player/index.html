<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JnfH Soundmap Builder</title>
  
  <link rel="stylesheet" href="css/player.css">
</head>
<body>
  <div id="app">
    <div id="controls">
      <div class="control-group">
        <h2 id="project-title">Soundmap Builder</h2>
        <button id="mode-btn" class="btn-primary">Edit Mode</button>
        <button id="play-btn" class="btn-secondary">Preview</button>
      </div>
      
      <div class="control-group">
        <h3>Background Image</h3>
        <input type="file" id="background-image" accept="image/*" style="margin-bottom: 8px;">
        <div style="display: flex; gap: 8px; margin-bottom: 8px;">
          <button id="toggle-image" class="btn-secondary" style="flex: 1;">Show Image</button>
          <button id="toggle-grid" class="btn-secondary" style="flex: 1;">Hide Grid</button>
        </div>
        <div style="display: flex; align-items: center; margin-bottom: 8px;">
          <label style="flex: 1; margin: 0;">Image Opacity</label>
          <input type="range" id="image-opacity" min="0" max="1" value="0.5" step="0.05" style="flex: 2;">
          <span id="image-opacity-value" style="width: 50px; text-align: right;">50%</span>
        </div>
        <button id="clear-image" class="btn-secondary" style="width: 100%;">Clear Image</button>
      </div>
      
      <div class="control-group">
        <label>Master Volume</label>
        <input type="range" id="master-volume" min="0" max="100" value="80">
        <span id="volume-value">80%</span>
      </div>
      
      <div class="control-group">
        <label>Fade Speed</label>
        <input type="range" id="fade-speed" min="0.05" max="1" value="0.3" step="0.05">
        <span id="fade-speed-value">0.3s</span>
      </div>
      
      <div id="edit-panel" class="control-group">
        <h3>Drawing Tools</h3>
        <button id="tool-select" class="btn-secondary" style="margin-bottom: 8px;">Select/Move</button>
        <div style="display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap;">
          <button id="tool-path" class="btn-secondary" style="flex: 1; min-width: 80px;">Path</button>
          <button id="tool-rectangle" class="btn-secondary" style="flex: 1; min-width: 80px;">Rectangle</button>
          <button id="tool-circle" class="btn-secondary" style="flex: 1; min-width: 80px;">Circle</button>
          <button id="tool-polygon" class="btn-secondary" style="flex: 1; min-width: 80px;">Polygon</button>
        </div>
        
        <div style="margin-bottom: 16px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="smooth-path" style="width: 18px; height: 18px; cursor: pointer;">
            <span style="font-size: 13px;">Smooth Curves (Path tool)</span>
          </label>
        </div>
        
        <div style="display: flex; align-items: center; margin-bottom: 16px;">
          <label style="flex: 1; margin: 0;">Line Thickness</label>
          <input type="range" id="line-thickness" min="1" max="20" value="2" style="flex: 2;">
          <span id="line-thickness-value" style="width: 40px; text-align: right;">2px</span>
        </div>
        
        <h3 id="audio-form-title">Assign Audio to Shape</h3>
        <input type="text" id="source-name" placeholder="Shape name">
        
        <label style="margin-top: 12px; display: block;">Zone Color</label>
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
          <input type="color" id="zone-color" value="#667eea" style="width: 60px; height: 40px; border: 2px solid #444; border-radius: 6px; cursor: pointer; padding: 0;">
          <span style="font-size: 12px; color: #999;">Click to change color</span>
        </div>
        
        <label style="margin-top: 12px; display: block;">Audio Source</label>
        <select id="audio-source-type" style="width: 100%; padding: 10px; background: #2a2a2a; border: 1px solid #444; border-radius: 6px; color: #e0e0e0; font-size: 13px; margin-bottom: 8px;">
          <option value="upload">Upload File</option>
          <option value="r2">From R2 Bucket</option>
        </select>
        
        <div id="upload-source" style="display: block;">
          <input type="file" id="audio-file" accept="audio/*">
        </div>
        
        <div id="r2-source" style="display: none;">
          <label style="display: block; margin-bottom: 8px; font-size: 12px; color: #999;">Load from File List:</label>
          <select id="r2-file-list-select" style="width: 100%; padding: 10px; background: #2a2a2a; border: 1px solid #444; border-radius: 6px; color: #e0e0e0; font-size: 13px; margin-bottom: 8px;">
            <option value="">-- Select a file list --</option>
          </select>
          <button id="load-r2-file-list" class="btn-secondary" style="margin-top: 8px; width: 100%;">Load Selected List</button>
          
          <div style="margin: 12px 0; text-align: center; color: #666; font-size: 11px;">OR</div>
          
          <label style="display: block; margin-bottom: 8px; font-size: 12px; color: #999;">Manual URL(s):</label>
          <input type="text" id="r2-url" placeholder="R2 URL(s) - comma separated for multiple">
          <button id="load-r2-file" class="btn-secondary" style="margin-top: 8px; width: 100%;">Load from R2</button>
        </div>
        
        <input type="number" id="fade-distance" placeholder="Fade distance (px)" value="100">
        <button id="assign-audio" class="btn-secondary">Assign Audio</button>
        <button id="cancel-edit" class="btn-secondary" style="display: none; margin-top: 8px;">Cancel Edit</button>
        <p style="font-size: 11px; color: #666; margin-top: 8px;">
          Select a drawing tool, draw a shape, then assign audio to it. Double-click a zone in the list to edit it.
        </p>
      </div>
      
      <div id="sources-list" class="control-group">
        <h3>Audio Zones (<span id="source-count">0</span>)</h3>
        <div style="display: flex; gap: 8px; margin-bottom: 12px;">
          <button id="copy-zone" class="btn-secondary" style="flex: 1;">Copy</button>
          <button id="paste-zone" class="btn-secondary" style="flex: 1;">Paste</button>
        </div>
        <div id="source-items"></div>
      </div>
      
      <div id="status" class="control-group status-hidden">
        <div class="status-item">
          <span class="label">Mode:</span>
          <span id="current-mode">Edit</span>
        </div>
        <div class="status-item">
          <span class="label">Distance:</span>
          <span id="distance-display">-</span>
        </div>
      </div>
      
      <div class="control-group">
        <button id="export-config" class="btn-secondary">Export Config</button>
        <button id="import-config" class="btn-secondary" style="margin-top: 8px;">Import Config</button>
        <input type="file" id="import-config-file" accept=".json" style="display: none;">
      </div>
      
      <div class="control-group">
        <h3>Instructions</h3>
        <p style="font-size: 11px; color: #999; line-height: 1.6;">
          <strong>Background Image:</strong><br>
          • Upload an image to trace shapes<br>
          • Adjust opacity to see your drawing<br>
          • Toggle grid/image visibility<br>
          <br>
          <strong>Drawing:</strong><br>
          • Select tool → Draw → Assign audio<br>
          • Rectangle/Circle: Click & drag<br>
          • Path: Click & drag (freehand)<br>
          • Polygon: Click points, double-click to finish<br>
          <br>
          <strong>Editing:</strong><br>
          • Select/Move tool: Click zone to select, drag to move<br>
          • Drag corners/handles to resize<br>
          • Double-click zone to edit properties<br>
          • Copy (Ctrl+C) / Paste (Ctrl+V) zones<br>
          • Delete key to remove selected zone<br>
          <br>
          <strong>Preview:</strong><br>
          • Move mouse to hear spatial audio<br>
          • Audio fades based on distance<br>
        </p>
      </div>
    </div>
    
    <div id="canvas-container" style="position: relative; width: 100%; height: 100vh; background: #0a0a0a;">
      <canvas id="canvas"></canvas>
    </div>
  </div>
  
  <script src="js/soundmap-builder.js"></script>
  
  <script>
    let builder;
    
    const defaultConfig = {
      title: "New Soundmap",
      canvasWidth: 1920,
      canvasHeight: 1080,
      audioZones: []
    };
    
    window.addEventListener('DOMContentLoaded', async () => {
      builder = new SpatialAudioBuilder('canvas', defaultConfig);
      await builder.init();
    });
  </script>
</body>
</html>
