<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JnfH Soundmap Builder</title>
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="css/player.css">
</head>
<body>
  <div id="app">
    <div id="controls">
      <div class="control-group">
        <h2 id="project-title">Soundmap Builder</h2>
        <button id="mode-btn" class="btn-primary">Edit Mode</button>
        <button id="play-btn" class="btn-secondary">Preview</button>
      </div>
      
      <div class="control-group">
        <label>Master Volume</label>
        <input type="range" id="master-volume" min="0" max="100" value="80">
        <span id="volume-value">80%</span>
      </div>
      
      <div class="control-group">
        <label>Fade Radius</label>
        <input type="range" id="fade-radius" min="100" max="1000" value="500" step="50">
        <span id="fade-radius-value">500m</span>
      </div>
      
      <div class="control-group">
        <label>Fade Speed</label>
        <input type="range" id="fade-speed" min="0.05" max="1" value="0.3" step="0.05">
        <span id="fade-speed-value">0.3s</span>
      </div>
      
      <div class="control-group">
        <label>Reverb Amount</label>
        <input type="range" id="reverb-amount" min="0" max="100" value="100">
        <span id="reverb-value">100%</span>
      </div>
      
      <div id="edit-panel" class="control-group">
        <h3>Add Audio Source</h3>
        <input type="text" id="source-name" placeholder="Source name">
        <input type="file" id="audio-file" accept="audio/*">
        <input type="number" id="max-distance" placeholder="Max distance (m)" value="500">
        <button id="add-source" class="btn-secondary">Add Point Source</button>
        <p style="font-size: 11px; color: #666; margin-top: 8px;">
          Click "Add Point Source" then click on the map to place the source
        </p>
        
        <hr style="margin: 20px 0; border: none; border-top: 1px solid #444;">
        
        <h3>Add Audio Path</h3>
        <input type="text" id="path-name" placeholder="Path name">
        <input type="file" id="path-audio-file" accept="audio/*">
        <input type="number" id="path-proximity" placeholder="Proximity distance (m)" value="500">
        <button id="add-path" class="btn-secondary">Start Drawing Path</button>
        <button id="finish-path" class="btn-secondary" style="display: none; margin-top: 8px;">Finish Path</button>
        <button id="cancel-path" class="btn-secondary" style="display: none; margin-top: 8px; background: #666;">Cancel</button>
        <p style="font-size: 11px; color: #666; margin-top: 8px;">
          Click "Start Drawing Path", then click on the map to add points. Double-click or click "Finish Path" to complete.
        </p>
      </div>
      
      <div id="sources-list" class="control-group">
        <h3>Audio Sources (<span id="source-count">0</span>)</h3>
        <div id="source-items"></div>
        <h3 style="margin-top: 20px;">Audio Paths (<span id="path-count">0</span>)</h3>
        <div id="path-items"></div>
      </div>
      
      <div id="status" class="control-group status-hidden">
        <div class="status-item">
          <span class="label">Mode:</span>
          <span id="current-mode">Edit</span>
        </div>
        <div class="status-item">
          <span class="label">Distance:</span>
          <span id="distance-display">-</span>
        </div>
      </div>
      
      <div class="control-group">
        <button id="export-config" class="btn-secondary">Export Config</button>
      </div>
      
      <div class="control-group">
        <h3>Instructions</h3>
        <p style="font-size: 12px; color: #999; line-height: 1.6;">
          <strong>Edit Mode:</strong><br>
          � Upload audio file and enter name<br>
          � Click "Add to Map"<br>
          � Click map to place source<br>
          � Drag sources to reposition<br>
          � Right-click to delete<br>
          <br>
          <strong>Preview Mode:</strong><br>
          � Move mouse to hear spatial audio<br>
          � HRTF binaural positioning<br>
          � Distance-based fading<br>
          � Reverb send/return system<br>
          <br>
          <strong>Export:</strong><br>
          � Saves config as JSON<br>
          � Upload audio files to R2 manually<br>
          � Config references R2 URLs
        </p>
      </div>
    </div>
    
    <div id="map"></div>
  </div>
  
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="js/soundmap-builder.js"></script>
  
  <script>
    let soundmapBuilder;
    
    const defaultConfig = {
      title: "New Soundmap",
      mapCenter: [51.5074, -0.1278],
      audioSources: [],
      audioPaths: []
    };
    
    soundmapBuilder = new SoundmapBuilder('map', defaultConfig);
    soundmapBuilder.init();
  </script>
</body>
</html>
